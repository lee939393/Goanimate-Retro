(function(d,g){var b=function(){};b.create=function(l){var k=d("<div/>").attr({id:l,"class":"modal hide"});return k};b.ensure=function(l){var k=d("#"+l);if(k.length==0){k=b.create(l).appendTo("body")}return k};b.prototype={loading:function(){this.$el.modal("loading")},load:function(k){var l=this;this.$el.modal();this.loading();d.get(k,function(m){l.$el.html(m).modal("layout");l.loading();l.$el.find('[rel="tooltip"]').tooltip({container:l.$el});l.remoteUrl=k;l.$el.trigger("loaded")})},refresh:function(){if(!this.remoteUrl){return}this.load(this.remoteUrl)},alert:function(l,k){k=k||"success";this.$el.find(".alert").remove();var m=d('<div class="alert"><button type="button" class="close" data-dismiss="alert">&times;</button></div>');m.addClass("alert-"+k).append(l).prependTo(this.$el.find(".modal-body"))}};var f=function(k){var l=this;this.$el=k;this.$el.on("submit.video.goanimate",".video-license-form",function(n){var m=d(this);n.preventDefault();l.publish(m.serialize())}).on("click",'[data-action="buttonControl"]',function(o){var n=d(this);var m=true;if(n.data("show")=="#transfer_rights_form"){}else{if(n.data("hide")=="#transfer_rights_form"&&n.data("show")!="#movie_license_enterance"){if(l.validateAddressForm()==true){l.setLicense(d("#movie-license-form").serialize())}else{m=false}l.previewLicense()}else{if(n.data("show")=="#payment_info"){l.showPaymentOverlay(n.data("frame-src"))}}}if(m==true){l.buttonControl(n.data("hide"),n.data("show"))}o.preventDefault()}).on("loaded",function(){l.resetState()})};f.sCountryWithoutZipCodeString="Afghanistan|Angola|Antigua and Barbuda|Aruba|Bahamas|Belize|Benin|Bhutan|Botswana|Burkina Faso|Burundi|Cameroon|Central African Republic|Comoros|Congo|Congo, The Democratic Republic of|Cook Islands|Cï¿½te d'Ivoire|Djibouti|Dominica|Equatorial Guinea|Eritrea|Fiji|Gambia|Gibraltar|Grenada|Guinea|Guyana|Hong Kong|Iceland|Kiribati|Korea, Democratic People's Republic of|Macao|Malawi|Mali|Mauritania|Mauritius|Montserrat|Namibia|Nauru|Netherlands Antilles|Niue|Panama|Qatar|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and The Grenadines|Seychelles|Sierra Leone|Solomon Islands|Somalia|Suriname|Tanzania, United Republic of|Tokelau|Tonga|Trinidad and Tobago|Tuvalu|Uganda|United Arab Emirates|Vanuatu|Yemen|Zimbabwe";f.aCountryWithoutZipCode=f.sCountryWithoutZipCodeString.split("|");f.sCanadaStatesString="Alberta|British Columbia|Manitoba|New Brunswick|Newfoundland|Northwest Territories|Nova Scotia|Nunavut|Ontario|Prince Edward Island|Quebec|Saskatchewan|Yukon Territory";f.aCanadaStates=f.sCanadaStatesString.split("|");f.sCanadaStatesCodeString="AB|BC|MB|NB|NL|NT|NS|NU|ON|PE|QC|SK|YT";f.aCanadaStatesCode=f.sCanadaStatesCodeString.split("|");f.sUSAStatesString="Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|District of Columbia|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|Armed Forces Americas|Armed Forces|Armed Forces Pacific";f.aUSAStates=f.sUSAStatesString.split("|");f.sUSAStatesCodeString="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|AA|AE|AP";f.aUSAStatesCode=f.sUSAStatesCodeString.split("|");f.prototype=d.extend({},b.prototype,{setLicense:function(l){var k=this;this.loading();d.post("/ajax/manageMovieOwner/set",l,function(m){k.loading();if(m.error){k.alert(m.error,"error")}else{formDataArray=l.split("&");for(var n=0;n<formDataArray.length;n++){pair=formDataArray[n].split("=");replace_value=decodeURIComponent(pair[1]);k.$el.find(".u_"+pair[0]).html(replace_value.replace("+"," "))}}},"json")},getLicense:function(){var k=this;this.loading();d.post("/ajax/manageMovieOwner/get",formData,function(l){k.loading();if(l.error){k.alert(l.error,"error")}else{alert(l)}},"json")},buttonControl:function(l,k){this.$el.find(l).hide();this.$el.find(k).show();if(k=="#ending"||k=="#failure"){this.$el.find(".movie_license_header").hide()}else{this.$el.find(".movie_license_header").show()}this.$el.modal("layout")},resetState:function(){var l=this;var m=this.$el.find("#cboCountry :selected").val();var k=this.$el.find("#user_state").val();if(m=="US"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();l.updateOptions(this.$el.find("#cboState"),f.aUSAStates,f.aUSAStatesCode);this.$el.find("#cboState").val(k)}else{if(m=="CA"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();l.updateOptions(this.$el.find("#cboState"),f.aCanadaStates,f.aCanadaStatesCode);this.$el.find("#cboState").val(k)}else{this.$el.find("#input-state").show();this.$el.find("#cboState").hide()}}l.updateZip()},toggleCompanyInput:function(){var l=this;var k=this.$el.find('[name="license_type"]:checked').val();if(k=="individual"){this.$el.find("#company_input").hide();this.$el.find('[name="company_name"]').val("")}else{if(k=="company"){this.$el.find("#company_input").show()}}},updateOptions:function(m,l,k){if(m.prop){var n=m.prop("options")}else{var n=m.attr("options")}d("option",m).remove();d.each(l,function(o,p){n[n.length]=new Option(p,k[o])})},updateZip:function(){var k=this;if(k.containsNoZip(this.$el.find("#cboCountry :selected").text())){this.$el.find("#fld_cczipcode").hide();this.$el.find("#cczipcode").val("00000")}else{if(this.$el.find("#cczipcode").val()=="00000"){this.$el.find("#cczipcode").val("")}this.$el.find("#fld_cczipcode").show()}},containsNoZip:function(l){for(var k=0;k<f.aCountryWithoutZipCode.length;k++){if(f.aCountryWithoutZipCode[k]===l){return true}}return false},validateAddressForm:function(){this.$el.find(".form-error").html("");var o=[];var k=this.$el.find('[name="company_name"]').val();var n=this.$el.find('[name="contact_person"]').val();var m=this.$el.find('[name="license_type"]:checked').val();var l=this.$el.find('[name="email"]').val();if(m=="company"){if(k==""){o.push({id:"fld_company_name",msg:GT.gettext("Please input your company name")})}}if(n==""){o.push({id:"fld_contact_person",msg:GT.gettext("Please input the name of your contact person")})}if(l!=""){if(!l.match(/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i)){o.push({id:"fld_email",msg:GT.gettext("Invalid email")})}}for(i=0;i<o.length;i++){content=(o[i].msg);this.$el.find("#"+o[i].id).html(content)}if(o.length>0){return false}else{return true}},previewLicense:function(){this.$el.find(".u_company_name").html(this.$el.find('[name="contact_person"]').val()+"/"+this.$el.find('[name="company_name"]').val())},showPaymentOverlay:function(k){var l=this.$el.find("#payment_info");var m=jQuery("<iframe></iframe>",{id:"cc-payment-iframe",scrolling:"no",allowTransparency:"true",frameborder:"0",width:634,height:647,src:k});this.$el.find(l).html(m)}});var e=function(k){var l=this;this.$el=k;this.$el.on("submit.video.goanimate",".video-publish-form",function(n){var m=d(this);n.preventDefault();l.publish(m.serialize())})};e.prototype=d.extend({},b.prototype,{publish:function(l){var k=this;this.loading();d.post("/ajax/saveMovieSettings",l,function(m){k.loading();if(m.error){k.alert(m.error,"error")}else{k.refresh();k.$el.trigger(d.Event("published"),[m.video])}},"json")}});var a=function(k){this.$el=k};a.prototype=d.extend({},b.prototype,{});var j=function(k,l){var m=this;this.$el=k;this.options=l;this.$el.on("click.video.goanimate","[data-video-export]",function(o){var n=d(this);o.preventDefault();if(n.data("videoExport")=="youtube"){m.popWindow(n.attr("href"))}else{m.requestExport(n.attr("href"))}}).on("exportError",function(o,n){m.alert(n.error,"error")}).on("exportSuccess",function(o,n){m.requestSuccess(n)})};j.prototype=d.extend({},b.prototype,{popWindow:function(k){g.open(k,"_go_video_export","toolbar=no,status=no,height=500,width=960")},requestExport:function(k){var l=this;d.get(k,function(m){if(m.error){l.alert(m.error,"error");return}l.requestSuccess(m)},"json")},requestSuccess:function(k){if(k.resolution){this.$el.find("."+k.resolution+" .video-export-action").html('<span class="btn btn-large btn-dark">'+GT.gettext("Processing")+"...</span>");if(k.type=="youtube"){this.alert(GT.gettext("Your video is being converted and will be exported to YouTube. You can close this window."))}else{this.alert(GT.gettext("You will receive an email once your video is ready for download. You can close this window."))}}}});g.videoExportError=function(k){d("#video-export").trigger("exportError",[k])};g.videoExportStarted=function(k){d("#video-export").trigger("exportSuccess",[k])};var c=function(k,l){var m=this;this.$el=k;this.options=l;this.$el.on("submit.video.goanimate",".video-settings-form",function(o){var n=d(this);o.preventDefault();m.post(n.serialize())})};c.prototype=d.extend({},b.prototype,{post:function(l){var k=this;k.loading();d.post("/ajax/saveMovieSettings",l,function(m){var n=d.Event("saved");k.loading();if(m.error){k.alert(m.error,"error")}else{k.$el.modal("hide");showNotice(GT.gettext("Video settings updated"));k.$el.trigger(n,[m.video])}},"json")}});var h={doDelete:function(k){if(!confirm(GT.gettext("Are you sure you have to delete this video?"))){return}d.post("/ajax/deleteMovie/"+k,function(l){parseResponse(l);if(responseArray.code=="0"){d("#video-"+k).fadeOut(300,function(){d(this).remove()});d(document).trigger("videoDeleted")}resetResponse()})},doUnDelete:function(k){d.post("/ajax/undeleteMovie/"+k,function(l){parseResponse(l);if(responseArray.code=="0"){d("#video-"+k).fadeOut(300,function(){d(this).remove()});d(document).trigger("videoRestored")}resetResponse()})}};d(document).on("click",'[data-action="video-share"]',function(n){var m=d(this),l=b.ensure("video-share"),k=l.data("videoShare");if(!k){l.data("videoShare",k=new e(l))}n.preventDefault();k.load(m.data("remote"))}).on("click",'[data-action="video-edit"]',function(n){var m=d(this),k=b.ensure("video-edit"),l=k.data("videoEdit");if(!l){k.data("videoEdit",l=new a(k))}n.preventDefault();l.load(m.data("remote"))}).on("click",'[data-action="video-export"]',function(m){var l=d(this),k=b.ensure("video-export"),n=k.data("videoExport");if(!n){k.data("videoExport",n=new j(k))}m.preventDefault();n.load(l.data("remote"))}).on("click",'[data-action="video-settings"]',function(m){var l=d(this),k=b.ensure("video-settings"),n=k.data("videoSettings");if(!n){k.data("videoSettings",n=new c(k))}m.preventDefault();n.load(l.data("remote"))}).on("click.video.goanimate",'[data-action="video-delete"]',function(k){k.preventDefault();h.doDelete(d(this).data("video"))}).on("click.video.goanimate",'[data-action="video-restore"]',function(k){k.preventDefault();h.doUnDelete(d(this).data("video"))}).on("click.video.goanimate",'[data-action="video-watermark"]',function(k){k.preventDefault();d.post("/ajax/getUserWatermarks/"+d(this).data("video"),function(l){showOverlay(l)})}).on("click",'[data-action="video-license"]',function(n){var m=d(this),k=b.ensure("video-license"),l=k.data("videoLicense");if(!l){k.data("VideoLicense",l=new f(k))}n.preventDefault();l.load(m.data("remote"))}).on("change",'[name="cbo_country"]',function(n){var m=d(this),k=b.ensure("video-license"),l=k.data("videoLicense");if(!l){k.data("VideoLicense",l=new f(k))}n.preventDefault();l.resetState()}).on("change",'[name="license_type"]',function(n){var m=d(this),k=b.ensure("video-license"),l=k.data("videoLicense");if(!l){k.data("VideoLicense",l=new f(k))}n.preventDefault();l.toggleCompanyInput()})})(jQuery,window);function emailShare(a){var b=$("#email-share");if(b.length==0){b=$('<div class="modal" id="email-share"><div class="modal-header"><button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button><h3></h3></div><div class="modal-body"></div></div>');b.find("h3").text(GT.gettext("Share video to your friends"));b.appendTo("body")}var d="/email_a_friend/share_movie/"+a;var c=$('<iframe id="ab" frameborder="0" scrolling="no"></iframe>');c.attr("src",d).css({width:"640px",height:"370px"});b.find(".modal-body").html(c);b.modal()};
